---
title: 题解|1008.Expectation of Rank-2023暑期杭电多校08
date: 2023/8/10
updated: 2023/9/28
tags:
  - 2023暑期杭电多校
  - 线性代数
  - 动态规划
categories: 算法竞赛
keywords:
top_img: false
comments: true
cover:
toc: true
abbrlink: 76ee6b8a
description: 题解|1008.Expectation of Rank-2023暑期杭电多校08 线性代数-向量空间·动态规划
toc_number:
toc_style_simple:
copyright:
copyright_author:
copyright_author_href:
copyright_url:
copyright_info:
highlight_shrink:
aside:
---

# 1008.Expectation of Rank
**线性代数-矩阵与向量空间、期望、动态规划**
## 题目大意
给定两个正整数 $n,p$ ，其中 $p$ 是质数
 $n$ 阶矩阵 $\bf A$ 中的所有元素随机在 $p$ 的有限域 $\mathbb{F}_p$ 中产生，求矩阵 $\bf A$ 的秩的期望 $\mathbb{E}(rank(\bf A))$ ，答案取模

### 前置知识点
1. [有限域](https://baike.baidu.com/item/%E6%9C%89%E9%99%90%E5%9F%9F/4273049) $\mathbb{F}_p$ ：在本题中可以粗略的理解为 $[0,p-1]$ 的整数集
2. 线性代数-矩阵与向量空间基础知识：多维向量与向量组、线性相关、矩阵的秩与向量之间的关系、向量组张成向量空间的概念等

建议在学习过《线性代数》课程后再解决本题。

## 解题思路
一个含 $k$ 个向量的极大无关组可以张成一个 $k$ 维向量空间

在 $p$ 的有限域 $\mathbb{F}_p$ 下，每一维度上的坐标有 $p$ 种选择，故以该极大无关组为基，通过线性组合可以产生 $p^k$ 种不同的 $k$ 维向量（高维包含低维）
顺带一提，这并不意味着这 $p^k$ 种向量仅有 $k$ 位坐标非 $0$ 

矩阵 $\bf A$ 的每一行可以视为一个 $n$ 维向量，前 $i$ 行的秩表示了前 $i$ 个向量组成的向量组，其极大无关组中有多少个向量。这也意味着前 $i$ 行已经张成了一个多少维度的向量空间

构造DP数组， $dp_{i,k}$ 用以表示矩阵 $\bf A$ 前 $i$ 行的秩为 $k$ 的方案数

假设前 $i-1$ 行的秩为 $k$ ，那么其张成的向量空间为 $k$ 维，考虑状态转移：
1. 第 $i$ 行中可以构造出 $p^k$ 个向量落在这个向量空间中，并不改变秩（或者说维数）
2. 余下 $p^n-p^k$ 个向量将与前 $i-1$ 个向量线性无关，并使张成的空间增大一维，秩 $+1$

综上所述，构造出以下状态转移方程：
$$dp_{i,k}=
\begin{cases}
    0 \qquad,k>i\quad(rank_i\le i恒成立) \newline
    1 \qquad,k=0\quad(当且仅当全为 \bf{0} \text{向量}) \newline
    \sum\limits_{j=1}^{i-1} dp_{i-1,j}\times p^j + dp_{i-1,j-1}\times (p^n-p^j) &,Otherwise
\end{cases}
$$

总方案数为 $(p^n)^n=p^{n^2}$ ，最终期望为 $\dfrac{1}{p^{n^2}}\sum\limits_{j=1}^{n} j\times dp_{n,j}$

### 时间复杂度
DP：$O(n^2)$

## 参考代码
> 参考代码为已AC代码主干，其中部分功能需读者自行实现

```cpp
#define N 5005
ll n,p;
ll dp[N][N],powp[N];//dp_i,k表示矩阵前i行秩为k的方案数
void Init(ll n){
    FORLL(i,0,n)
        FORLL(j,0,n)
            dp[i][j]=0;
    powp[0]=1;
    dp[0][0]=1;
    FORLL(i,1,n) powp[i]=mul(powp[i-1],p);
}
void solve()
{
    cin >> n >> p;
    Init(n);
    FORLL(i,1,n){
        dp[i][0]=1;
        FORLL(k,1,i){//每行看作一个向量，有p^n种构造法。确定前i行的秩为k的总向量方案数
            addto(dp[i][k],mul(dp[i-1][k],powp[k]));
            //对于前i-1行秩为k的某方案，其向量空间为k维，故在p的有限集下有且仅有p^k个向量落在该向量空间
            addto(dp[i][k],mul(dp[i-1][k-1],sub(powp[n],powp[k-1])));
            //对于前i-1行秩为k-1的某方案，有p^(k-1)个向量落在其张成的向量空间，剩余向量与前i-1行线性无关
        }
    }
    ll re=0,ninv=inv(qcpow(powp[n],n));//ninv:总方案数(p^n)^n的倒数
    FORLL(i,1,n) addto(re,mul(mul(i,dp[n][i]),ninv));
    cout << re << endl;
}
```